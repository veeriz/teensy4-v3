[env:teensy40]
platform = teensy
board = teensy40
framework = arduino
upload_protocol = teensy-cli
lib_deps =
    https://github.com/tonton81/FlexCAN_T4.git

; Build flags including include paths and compiler optimizations
build_flags = 
    -D USB_SERIAL
    -D TEENSY_OPT_FASTEST
    -I include
    -I src
    -D CAN_BAUDRATE=500000
    -D CAN_RX_QUEUE_SIZE=32
    -D CAN_TX_QUEUE_SIZE=16
    -D CAN_ERROR_THRESHOLD=100
    -D CAN_TIMEOUT_MS=1000
    -mthumb 
    -mcpu=cortex-m7
    -mfloat-abi=hard
    -mfpu=fpv5-d16
    -std=gnu++14
    -fexceptions
    -frtti
    ; Linker fixes for ARM
    -Wl,--gc-sections
    -Wl,--relax
    -Wl,--print-memory-usage
    -Wl,--defsym=__rtc_localtime=0
    ; Enable printf float support
    -Wl,-u,_printf_float
    -Wl,-u,_scanf_float

; C++ specific flags
build_flags_extra =
    -std=gnu++14
    -fexceptions
    -frtti

; Disable PlatformIO's default flags
build_unflags =
    -fno-exceptions
    -fno-rtti

build_flags_cpp =
    -std=gnu++14
    -fno-exceptions
    -fno-rtti

build_flags_c =
    -std=gnu11
    -fno-strict-aliasing